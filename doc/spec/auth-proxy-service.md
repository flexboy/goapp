# AuthProxy Service


## Overview
* AuthProxy
    * クライアントの認証・認可を行い、各種サービスにプロキシするサービス
        * すべてのリクエストはこのプロキシを経由する
    * クライアントは、初回に必ずトークン認証をする
        * 「ユーザ名・パスワード・プロジェクト名」により認証し、トークンが発行される
        * トークンには以下の情報を含む
            * ユーザ名
            * ロール名
            * プロジェクト名
            * プロジェクトロール名
            * トークン有効期限
            * サービスカタログ
                * 「サービス名・説明」のハッシュテーブル
    * クライアントは、リクエスト時にトークンと、サービス名、メソッド名を指定し、適切なデータをセットしてリクエストする
    * プロキシは、トークンとサービス名とメソッド名によって認証・認可を行い、バックエンドサービスに適切にルーティングする
        * サービスのルーティング、メソッドの認可の設定は、プロキシ起動時にservice.dディレクトリに保存したyamlで行う
    * プロキシとバックエンドサービスとのやり取りは、gRPCによって行う


## Data Model
* User
    * ユーザデータそのもの
    * ユーザ名、パスワードを保持
* Role
    * Userは複数のProjectに属することができる
    * Projectに属するとき、"admin"や"member"などのRoleによってUserとProjectは紐図けられる
    * このRoleにより、Project内でのUser権限を制御する
        * デフォルトRole
            * "admin"
                * Projectの編集やUserの追加削除ができる
            * "member"
                * 各種サービスの基本操作
* Project
    * プロジェクトデータそのもの
* ProjectRole
    * プロジェクトに"admin"、"system"、"tenant"などのProjectRoleを紐図けられる
    * このProjectRoleにより、クラスタ内でのProject権限をする
        * デフォルトProjectRole
            * "admin"
                * 管理者権限
                * すべてを操作が可能
            * "system"
                * システム権限
                * システム上必要なすべての操作が可能
            * "tenant"
                * 一般ユーザテナント権限
                * テナント内に閉じた操作が可能
